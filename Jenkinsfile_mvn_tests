pipeline {
    agent any
    stages {
        stage("build-staging") {
            steps {
                script {
                    successJob = 'false'
                    build('STAGING')
                }
            }
        }
        stage('deploy-staging') {
            steps {
                script {
                    deploy('STAGING')
                }
            }
        }
        stage('test-staging') {
            steps {
                script {
                    test('STAGING')
                }
            }
        }
        stage("build-production)") {
            steps {
                script {
                    successJob = 'false'
                    build('PRODUCTION')
                }
            }
        }
        stage('deploy-production)') {
            steps {
                script {
                    deploy('PRODUCTION')
                }
            }
        }
        stage('test-production)') {
            steps {
                script {
                    test('PRODUCTION')
                }
            }
        }
    }
}

def build(String environment) {
    echo "Build on ${environment} was started"
    echo "The build number - ${env.BUILD_NUMBER}"
    sh 'echo  Execution servertime - `date`'
    env.STAGE_STATUS = 'OK'
}

def deploy(String environment) {
    echo "Deploy started on ${environment}"

    echo "${env.STAGE_STATUS}"
}

def test(String environment) {
    echo "Test executed on ${environment}"

    sh "docker run -t --network=test-automation-setup mvn_tests mvn clean test -Dbrowser=chrome -X -DgridURL=selenium-hub:4444"
}